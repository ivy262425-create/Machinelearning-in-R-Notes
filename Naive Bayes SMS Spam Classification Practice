# ---- Naive Bayes SMS Spam Classification Practice ----
# 本代码是学习《Machine Learning with R》书籍中的一个小实践。
# 目标：使用 Naive Bayes 算法对短信数据集进行垃圾短信分类。
#
# This script is a small practice exercise from the book *Machine Learning with R*.
# Objective: Apply the Naive Bayes algorithm to classify SMS messages as spam or ham.

# ---- Data Loading and Preprocessing ----
sms <- read.csv("E:\\zxy.ntu\\Analytics Solftware\\sms_spam.csv")
str(sms)
sms$type <- factor(sms$type)   # convert labels to factor
str(sms$type)
table(sms$type)

# ---- Text Processing Preparation ----
install.packages("tm")
library(tm)
sms_corpus <- VCorpus(VectorSource(sms$text)) # create corpus
print(sms_corpus)
as.character(sms_corpus[[2]])
inspect(sms_corpus[1:3])
lapply(sms_corpus[1:3], as.character)

# ---- Text Cleaning ----
sms_corpus_clean <- tm_map(sms_corpus, content_transformer(tolower)) # lowercase
as.character(sms_corpus_clean[[2]])
sms_corpus_clean <- tm_map(sms_corpus_clean, removeNumbers)          # remove numbers
getTransformations()
stopwords()
sms_corpus_clean <- tm_map(sms_corpus_clean, removeWords, stopwords()) # remove stopwords
sms_corpus_clean <- tm_map(sms_corpus_clean, removePunctuation)        # remove punctuation
install.packages("SnowballC")
library(SnowballC)
sms_corpus_clean <- tm_map(sms_corpus_clean, stemDocument)             # stemming
sms_corpus_clean <- tm_map(sms_corpus_clean, stripWhitespace)          # remove extra whitespace

# ---- Document-Term Matrix ----
sms_dtm <- DocumentTermMatrix(sms_corpus_clean)
sms_dtm2 <- DocumentTermMatrix(sms_corpus, control = list(
          tolower = TRUE,
          removeNumbers = TRUE,
          stopwords = TRUE,
          removePunctuation = TRUE,
          stemming = TRUE))

# ---- Train-Test Split ----
sms_dtm_train <- sms_dtm[1:4169,]
sms_dtm_test <- sms_dtm[4169:5559,]
sms_train_labels <- sms[1:4169, ]$type
sms_test_labels <- sms[4169:5559,]$type
prop.table(table(sms_test_labels))

# ---- Visualization with Wordcloud ----
install.packages("wordcloud")
library(wordcloud)
wordcloud(sms_corpus_clean, min.freq = 50, random.order = FALSE)
spam <- subset(sms, type=='spam')
ham <- subset(sms, type=='ham')
wordcloud(spam$text, max.words = 40, scale=c(3, 0.5))

# ---- Feature Engineering ----
sms_freq_words <- findFreqTerms(sms_dtm_train, 5)
str(sms_freq_words)
sms_dtm_freq_train <- sms_dtm_train[ , sms_freq_words]
sms_dtm_freq_test <- sms_dtm_test[,sms_freq_words]

# custom function: convert counts to Yes/No
convert_counts <- function(x){
  x <- ifelse(x>0, 'Yes','No')
}
sms_train <- apply(sms_dtm_freq_train, 2, convert_counts)
sms_test <- apply(sms_dtm_freq_test, 2, convert_counts)

# ---- Model Training and Prediction ----
install.packages("e1071")
library(e1071)
sms_classifier <- naiveBayes(sms_train, sms_train_labels)
sms_test_pred <- predict(sms_classifier, sms_test)

# ---- Model Evaluation ----
library(gmodels)
CrossTable(sms_test_pred, sms_test_labels,
           prop.chisq = FALSE, prop.t = FALSE,
           dnn = c('predicted', 'actual'))

# ---- Model Improvement (Laplace Smoothing) ----
sms_classifier2 <- naiveBayes(sms_train, sms_train_labels, laplace = 1)
sms_test_pred2 <- predict(sms_classifier2, sms_test)
CrossTable(sms_test_pred2, sms_test_labels,
           prop.chisq = FALSE, prop.t = FALSE,
           dnn = c("predicted","actual"))

# ---- Reflection ----
# 这是我学习书上的 Naive Bayes 小实践。
# 通过这个练习，我理解了文本清洗、特征提取和分类模型的完整流程。
# 不足之处在于参数选择和特征工程还比较粗糙，
# 未来可以尝试更系统的调参方法，以及更深入的 EDA 来提升模型表现。
#
# This was a small Naive Bayes practice from the textbook.
# Through this exercise, I learned the complete workflow of text cleaning,
# feature extraction, and classification modeling.
# Limitations include rough parameter choices and basic feature engineering.
# In the future, I plan to explore more systematic tuning methods
# and deeper EDA to improve model performance.
